# ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ã‚¬ã‚¤ãƒ‰

## ã‚¨ãƒ©ãƒ¼: "Unexpected token '<', "<!DOCTYPE "... is not valid JSON"

### ç—‡çŠ¶
- ãƒ­ã‚°ã‚¤ãƒ³æˆåŠŸå¾Œã€ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- ãƒ–ãƒ©ã‚¦ã‚¶ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã«ã€ŒUnexpected token '<'ã€ã‚¨ãƒ©ãƒ¼
- GAS APIã‹ã‚‰HTMLãŒè¿”ã£ã¦ãã¦ã„ã‚‹

### åŽŸå› 
GAS APIãŒJSONã§ã¯ãªãHTMLã‚’è¿”ã—ã¦ã„ã‚‹çŠ¶æ…‹ã§ã™ã€‚ä»¥ä¸‹ã®ã„ãšã‚Œã‹ã®åŽŸå› ãŒè€ƒãˆã‚‰ã‚Œã¾ã™ï¼š

#### 1. **ç’°å¢ƒå¤‰æ•°ãŒè¨­å®šã•ã‚Œã¦ã„ãªã„**ï¼ˆæœ€ã‚‚å¯èƒ½æ€§ãŒé«˜ã„ï¼‰

**ãƒã‚§ãƒƒã‚¯æ–¹æ³•**:
```bash
# Vercelã®ç’°å¢ƒå¤‰æ•°ã‚’ç¢ºèª
vercel env ls

# ãƒ­ãƒ¼ã‚«ãƒ«ã®å ´åˆ
cat apps/web/.env.local
```

**å¿…è¦ãªç’°å¢ƒå¤‰æ•°**:
- `GAS_API_BASE` - GAS Web Appã®URL
- `GAS_API_KEY` - GASã®APP_TOKEN
- `GOOGLE_CLIENT_ID`
- `GOOGLE_CLIENT_SECRET`
- `NEXTAUTH_SECRET`
- `ALLOWED_EMAILS`

**è§£æ±ºæ–¹æ³•**:
1. Vercelãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ã€ŒSettingsã€â†’ã€ŒEnvironment Variablesã€ã‚’é–‹ã
2. ã™ã¹ã¦ã®ç’°å¢ƒå¤‰æ•°ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
3. ç‰¹ã«`GAS_API_BASE`ã¨`GAS_API_KEY`ã‚’ç¢ºèª
4. å¤‰æ›´å¾Œã€å†ãƒ‡ãƒ—ãƒ­ã‚¤

#### 2. **GAS_API_KEYãŒé–“é•ã£ã¦ã„ã‚‹**

GASã®Script Propertiesã®`APP_TOKEN`ã¨ã€Vercelã®`GAS_API_KEY`ãŒä¸€è‡´ã—ã¦ã„ãªã„ã€‚

**è§£æ±ºæ–¹æ³•**:
1. GASã‚¨ãƒ‡ã‚£ã‚¿ã‚’é–‹ã
2. ã€Œãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è¨­å®šã€â†’ã€Œã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã€
3. `APP_TOKEN`ã®å€¤ã‚’ç¢ºèª
4. Vercelã®`GAS_API_KEY`ã¨ä¸€è‡´ã™ã‚‹ã‹ç¢ºèª
5. ä¸€è‡´ã—ãªã„å ´åˆã€ã©ã¡ã‚‰ã‹ã‚’ä¿®æ­£

#### 3. **GASå´ã®SPREADSHEET_IDãŒè¨­å®šã•ã‚Œã¦ã„ãªã„**

GASã®config.jsã§SPREADSHEET_IDãŒå¿…è¦ã§ã™ã€‚

**è§£æ±ºæ–¹æ³•**:
1. ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®URLã‹ã‚‰IDã‚’å–å¾—
   ```
   https://docs.google.com/spreadsheets/d/YOUR_SPREADSHEET_ID/edit
                                          ^^^^^^^^^^^^^^^^^^^^
   ```
2. GASã‚¨ãƒ‡ã‚£ã‚¿ã§ã€Œãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®è¨­å®šã€â†’ã€Œã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ—ãƒ­ãƒ‘ãƒ†ã‚£ã€
3. ä»¥ä¸‹ã‚’è¿½åŠ ï¼š
   - `SPREADSHEET_ID` = ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆID
   - `APP_TOKEN` = ãƒ©ãƒ³ãƒ€ãƒ ãªé•·ã„æ–‡å­—åˆ—ï¼ˆ32æ–‡å­—ä»¥ä¸ŠæŽ¨å¥¨ï¼‰

#### 4. **GAS Web AppãŒæ­£ã—ããƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¦ã„ãªã„**

**ç¢ºèªæ–¹æ³•**:
```bash
# GASãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§
cd apps/gas

# ãƒ‡ãƒ—ãƒ­ã‚¤ã‚’å®Ÿè¡Œ
pnpm deploy:prod
```

**ãƒ‡ãƒ—ãƒ­ã‚¤å¾Œã®ç¢ºèª**:
1. GASã‚¨ãƒ‡ã‚£ã‚¿ã§ã€Œãƒ‡ãƒ—ãƒ­ã‚¤ã€â†’ã€Œãƒ‡ãƒ—ãƒ­ã‚¤ã‚’ç®¡ç†ã€
2. æœ€æ–°ã®ãƒ‡ãƒ—ãƒ­ã‚¤URLã‚’ã‚³ãƒ”ãƒ¼
3. Vercelã®`GAS_API_BASE`ã«è¨­å®š

#### 5. **GAS Web Appã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒæ­£ã—ããªã„**

**ç¢ºèªæ–¹æ³•**:
1. GASã‚¨ãƒ‡ã‚£ã‚¿ã§ã€Œãƒ‡ãƒ—ãƒ­ã‚¤ã€â†’ã€Œãƒ‡ãƒ—ãƒ­ã‚¤ã‚’ç®¡ç†ã€
2. ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªãƒ‡ãƒ—ãƒ­ã‚¤ã‚’é¸æŠž
3. ã€Œã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼ã€ã‚’ç¢ºèª

**æŽ¨å¥¨è¨­å®š**:
- **å®Ÿè¡Œè€…**: è‡ªåˆ†
- **ã‚¢ã‚¯ã‚»ã‚¹ã§ãã‚‹ãƒ¦ãƒ¼ã‚¶ãƒ¼**: å…¨å“¡ï¼ˆAPIéµã§åˆ¶é™ã™ã‚‹ãŸã‚ï¼‰

## ãƒ‡ãƒãƒƒã‚°æ–¹æ³•

### 1. Next.jså´ã®ãƒ­ã‚°ã‚’ç¢ºèª

Vercelã®å ´åˆï¼š
1. Vercelãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰
2. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚’é¸æŠž
3. ã€ŒLogsã€ã‚¿ãƒ–
4. ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèª

ãƒ­ãƒ¼ã‚«ãƒ«ã®å ´åˆï¼š
```bash
cd apps/web
pnpm dev
```

ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã«ä»¥ä¸‹ã®ã‚ˆã†ãªãƒ­ã‚°ãŒè¡¨ç¤ºã•ã‚Œã¾ã™ï¼š
```
âŒ GAS API configuration error: { hasBase: false, hasKey: false }
# ã¾ãŸã¯
ðŸ“¡ Calling GAS API: { path: 'dashboard', from: undefined, to: undefined }
âŒ GAS API error: { status: 401, statusText: 'Unauthorized' }
```

### 2. GASå´ã®ãƒ­ã‚°ã‚’ç¢ºèª

1. GASã‚¨ãƒ‡ã‚£ã‚¿ã‚’é–‹ã
2. ã€Œå®Ÿè¡Œã€â†’ã€Œå®Ÿè¡Œãƒ­ã‚°ã€
3. ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèª

ã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼ï¼š
- `unauthorized` - APIéµãŒä¸€è‡´ã—ã¦ã„ãªã„
- `SPREADSHEET_IDãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“` - Script Propertiesã®è¨­å®šæ¼ã‚Œ
- `Cannot read property` - ã‚¹ãƒ—ãƒ¬ãƒƒãƒ‰ã‚·ãƒ¼ãƒˆã®åˆ—åãŒä¸ä¸€è‡´

### 3. GAS APIã‚’ç›´æŽ¥ãƒ†ã‚¹ãƒˆ

```bash
# APIéµã‚’ä½¿ã£ã¦ãƒ†ã‚¹ãƒˆï¼ˆcurlã§ï¼‰
curl "https://script.google.com/macros/s/YOUR_SCRIPT_ID/exec?path=dashboard&key=YOUR_APP_TOKEN"
```

æ­£å¸¸ãªå ´åˆã®ãƒ¬ã‚¹ãƒãƒ³ã‚¹ï¼š
```json
{
  "kpi": {
    "revenue": 1000000,
    "orders": 50,
    "stockTotal": 200
  },
  "series": {}
}
```

ã‚¨ãƒ©ãƒ¼ã®å ´åˆï¼š
```json
{
  "error": "unauthorized",
  "_status": 401
}
```

ã¾ãŸã¯ã€HTMLãŒè¿”ã£ã¦ãã‚‹ï¼ˆè¨­å®šã‚¨ãƒ©ãƒ¼ï¼‰

## ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

ãƒ‡ãƒ—ãƒ­ã‚¤å‰ã«ä»¥ä¸‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ï¼š

### GASå´
- [ ] `apps/gas`ãŒãƒ‡ãƒ—ãƒ­ã‚¤ã•ã‚Œã¦ã„ã‚‹
- [ ] Script Propertiesã«`APP_TOKEN`ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] Script Propertiesã«`SPREADSHEET_ID`ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] Web Appã®ã‚¢ã‚¯ã‚»ã‚¹æ¨©é™ãŒã€Œå…¨å“¡ã€ã«ãªã£ã¦ã„ã‚‹
- [ ] ãƒ‡ãƒ—ãƒ­ã‚¤URLãŒæ­£ã—ã„ï¼ˆ`/exec`ã§çµ‚ã‚ã‚‹ï¼‰

### Vercelå´
- [ ] `GAS_API_BASE`ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ï¼ˆGASã®ãƒ‡ãƒ—ãƒ­ã‚¤URLï¼‰
- [ ] `GAS_API_KEY`ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ï¼ˆGASã®APP_TOKENã¨ä¸€è‡´ï¼‰
- [ ] `GOOGLE_CLIENT_ID`ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] `GOOGLE_CLIENT_SECRET`ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] `NEXTAUTH_SECRET`ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] `ALLOWED_EMAILS`ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] Google Cloud Consoleã§ãƒªãƒ€ã‚¤ãƒ¬ã‚¯ãƒˆURIãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹

### å‹•ä½œç¢ºèª
- [ ] ãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] Googleãƒ­ã‚°ã‚¤ãƒ³ãŒã§ãã‚‹
- [ ] ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] KPIã‚«ãƒ¼ãƒ‰ã«ãƒ‡ãƒ¼ã‚¿ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- [ ] ã‚¨ãƒ©ãƒ¼ãŒè¡¨ç¤ºã•ã‚Œãªã„

## ã‚ˆãã‚ã‚‹è³ªå•

### Q: "GAS API not configured"ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹
A: Vercelã®ç’°å¢ƒå¤‰æ•°ãŒè¨­å®šã•ã‚Œã¦ã„ã¾ã›ã‚“ã€‚`GAS_API_BASE`ã¨`GAS_API_KEY`ã‚’è¨­å®šã—ã¦ãã ã•ã„ã€‚

### Q: "unauthorized"ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹
A: `GAS_API_KEY`ãŒGASã®`APP_TOKEN`ã¨ä¸€è‡´ã—ã¦ã„ã¾ã›ã‚“ã€‚ä¸¡æ–¹ã®å€¤ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

### Q: "ãƒ‡ãƒ¼ã‚¿å–å¾—ã‚¨ãƒ©ãƒ¼"ãŒè¡¨ç¤ºã•ã‚Œã‚‹
A: GAS APIãŒæ­£å¸¸ã«å‹•ä½œã—ã¦ã„ã¾ã›ã‚“ã€‚GASå´ã®ãƒ­ã‚°ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

### Q: ãƒ­ã‚°ã‚¤ãƒ³å¾Œã™ãã«ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹
A: èªè¨¼ã¯æˆåŠŸã—ã¦ã„ã‚‹ã®ã§ã€GAS APIã¨ã®æŽ¥ç¶šã«å•é¡ŒãŒã‚ã‚Šã¾ã™ã€‚ç’°å¢ƒå¤‰æ•°ã¨GASã®ãƒ‡ãƒ—ãƒ­ã‚¤çŠ¶æ…‹ã‚’ç¢ºèªã—ã¦ãã ã•ã„ã€‚

### Q: ãƒ­ãƒ¼ã‚«ãƒ«ã§ã¯å‹•ããŒVercelã§å‹•ã‹ãªã„
A: Vercelã®ç’°å¢ƒå¤‰æ•°ãŒæ­£ã—ãè¨­å®šã•ã‚Œã¦ã„ãªã„å¯èƒ½æ€§ãŒã‚ã‚Šã¾ã™ã€‚ã™ã¹ã¦ã®ç’°å¢ƒå¤‰æ•°ã‚’å†ç¢ºèªã—ã¦ãã ã•ã„ã€‚

## ç·Šæ€¥æ™‚ã®å¯¾å¿œ

### ã‚¹ãƒ†ãƒƒãƒ—1: ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ç¢ºèª
1. ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã‚’é–‹ãï¼ˆF12ï¼‰
2. ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å…¨ä½“ã‚’ã‚³ãƒ”ãƒ¼

### ã‚¹ãƒ†ãƒƒãƒ—2: Vercelã®ãƒ­ã‚°ã‚’ç¢ºèª
1. Vercelãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰â†’Logs
2. æœ€æ–°ã®ãƒ­ã‚°ã‚’ç¢ºèª
3. ã‚¨ãƒ©ãƒ¼ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚³ãƒ”ãƒ¼

### ã‚¹ãƒ†ãƒƒãƒ—3: ç’°å¢ƒå¤‰æ•°ã‚’å†ç¢ºèª
```bash
# å¿…è¦ãªç’°å¢ƒå¤‰æ•°ãŒã™ã¹ã¦è¨­å®šã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
vercel env ls

# ä¸è¶³ã—ã¦ã„ã‚‹å ´åˆã¯è¿½åŠ 
vercel env add GAS_API_BASE
vercel env add GAS_API_KEY
```

### ã‚¹ãƒ†ãƒƒãƒ—4: GASã‚’å†ãƒ‡ãƒ—ãƒ­ã‚¤
```bash
cd apps/gas
pnpm deploy:prod
```

### ã‚¹ãƒ†ãƒƒãƒ—5: Vercelã‚’å†ãƒ‡ãƒ—ãƒ­ã‚¤
```bash
cd apps/web
vercel --prod --force
```

ã“ã‚Œã§è§£æ±ºã—ãªã„å ´åˆã¯ã€ã“ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ã€Œãƒ‡ãƒãƒƒã‚°æ–¹æ³•ã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‚ç…§ã—ã¦ãã ã•ã„ã€‚

